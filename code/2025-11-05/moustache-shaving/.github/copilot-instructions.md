# Copilot Instructions

- **Project Shape**: A single p5.js sketch lives in `index-sketch.js`. The lone entry point `index.html` loads it once; the module wires p5’s lifecycle onto `window.*` and boots the desired scene (optionally via `?scene=ace`).
- **Scene System**: `class/SceneManager.js` swaps scene objects created in `scenes/*.js`. `BaseScene` (in `scenes/BaseScene.js`) provides the lifecycle shell, while helpers in `scenes/shared.js` handle pattern drawing. Each scene receives the shared context with assets, the hand cursor, and a `switchScene(name)` helper—rely on this instead of spinning up new canvases.
- **Assets & Preload**: `index-sketch.js` loads every image and sound once inside `loadAssets()`. Access sprites through `shared.assets.images.*` (e.g. `moustachePrimary`, `aceOfSpade`) so scenes reuse buffers instead of reloading them.
- **Hand Tracking Pipeline**: The Mediapipe `Hands` instance is initialised in `index-sketch.js`. `shared.updateHandTracking()` wraps `utils/HandleLandmarks.js`, moving the shared `HandCursor` and returning the gesture state. Call it once per frame in scenes that need live input.
- **Gesture Classifier**: `class/GestureClassifier.js` still tags the closest hand as `open` or `closed` based on fingertip closure (>0.20). Do not change that contract without updating `HandleLandmarks` and every scene that inspects `closeness.state`.
- **Cursor & Audio**: `class/HandCursor.js` keeps stateful sprites and guards against replaying `assets/sounds/rasor.mp3` every frame. When adding new interactions, always call `showOpenHand()/showClosedHand()` so sound and sprite state stay in sync, and read interaction coordinates from `handCursor.getTop()`.
- **Moustache Rendering**: `class/Moustache.js` renders into an offscreen buffer for alpha-based erasure and particle emission. Scenes reposition moustaches by updating `x/y`; width stays constant (500–600px). For new moustaches, cache images during preload and construct `new Moustache(pos.x, pos.y, desiredWidth, image)` in `enter()`.
- **Scene Examples**: `KingScene` erases the moustache when the cursor closes; on 99 % erasure it calls `shared.switchScene("ace")`. `AceScene` reuses the same pipeline but teleports the moustache when the closed cursor overlaps. `RecomposeScene` can be triggered by calling `shared.switchScene("recompose")` and focuses on background choreography without hand tracking.
- **Styling & Copy**: HTML overlays with IDs `info` and `textBubble` come from `style.css`. Scenes call `shared.setOverlayText({ info, bubble })` to refresh their copy, so keep those IDs stable for consistent typography (Pally font) and positioning.
- **Runtime Requirements**: Serve the folder over HTTP (e.g. `python3 -m http.server 8080`) so ES modules, p5, and Mediapipe assets load. `index-sketch.js` attaches the p5 lifecycle handlers directly to `window.preload/setup/draw/windowResized`.
- **Debug Tips**: Use `GestureClassifier.drawHands()` inside a scene’s `draw()` to visualise landmarks (expects global `width/height`). Video capture defaults to 640×480 mirrored (`selfieMode`); update `handleLandmarks` call sites if you change camera dimensions.

Let me know which sections need more detail or if any behaviour is still unclear.
